<!--pages/monitor-detail/monitor-detail.wxml-->
<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <view wx:else class="monitor-detail">
    <view wx:if="{{monitorInfo}}">
      <!-- è§†é¢‘åŒºåŸŸ -->
      <view class="video-section">
        <video
          wx:if="{{hlsUrl}}"
          class="video-player"
          src="{{hlsUrl}}"
          controls
          autoplay
          object-fit="contain"
          show-center-play-btn
          enable-play-gesture
        />
        <view wx:else class="no-video">
          <view class="no-video-icon">ğŸ“¹</view>
          <text class="no-video-text">{{monitorInfo.videoStreamUrl ? 'ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯åŠ¨è§†é¢‘æµ' : 'æš‚æ— è§†é¢‘æµ'}}</text>
        </view>
        
        <!-- å®æ—¶ç›‘æ§æ ‡ç­¾ -->
        <view wx:if="{{isStreaming && monitorInfo.status === 'ONLINE'}}" class="live-badge">
          <view class="live-dot"></view>
          <text>å®æ—¶ç›‘æ§</text>
        </view>

        <!-- è§†é¢‘æ§åˆ¶æŒ‰é’® -->
        <view wx:if="{{monitorInfo.videoStreamUrl}}" class="video-controls">
          <button 
            wx:if="{{!isStreaming}}" 
            class="control-btn start-btn" 
            bindtap="startVideo"
            size="mini"
          >
            <text class="btn-icon">â–¶</text>
            <text class="btn-text">å¯åŠ¨è§†é¢‘</text>
          </button>
          <button 
            wx:else 
            class="control-btn stop-btn" 
            bindtap="stopVideo"
            size="mini"
          >
            <text class="btn-icon">â– </text>
            <text class="btn-text">åœæ­¢è§†é¢‘</text>
          </button>
        </view>
      </view>

      <!-- ç›‘æµ‹ç‚¹ä¿¡æ¯å¡ç‰‡ -->
      <view class="info-card">
        <view class="card-header">
          <view class="title-row">
            <text class="card-title">{{monitorInfo.name}}</text>
            <view class="status-badge {{monitorInfo.status === 'ONLINE' ? 'status-online' : 'status-offline'}}">
              <view class="status-dot"></view>
              <text>{{monitorInfo.status === 'ONLINE' ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
            </view>
          </view>
          <view wx:if="{{monitorInfo.description}}" class="card-desc">
            {{monitorInfo.description}}
          </view>
        </view>
        
        <view class="location-row">
          <text class="location-icon">ğŸ“</text>
          <text class="location-text">{{monitorInfo.latitude}}, {{monitorInfo.longitude}}</text>
        </view>
      </view>

      <!-- ç›‘æµ‹æ•°æ®åŒºåŸŸ -->
      <view class="data-card">
        <view class="data-header">
          <text class="data-title">ç›‘æµ‹æ•°æ®</text>
          <text class="data-subtitle">å®æ—¶ç¯å¢ƒå‚æ•°</text>
        </view>

        <view wx:if="{{monitorData.length > 0}}" class="data-content">
          <view class="data-item" wx:for="{{monitorData}}" wx:key="id">
            <view class="data-left">
              <text class="data-label">
                <text wx:if="{{getDataTypeText(item.dataType)}}">{{getDataTypeText(item.dataType)}}</text>
                <text wx:else>{{item.dataType || 'æœªçŸ¥å‚æ•°'}}</text>
              </text>
              <text class="data-time">{{formatTime(item.recordedTime)}}</text>
            </view>
            <view class="data-right">
              <view class="value-with-unit">
                <text class="data-value">{{item.value}}</text>
                <text wx:if="{{getDataUnit(item.dataType)}}" class="data-unit"> {{getDataUnit(item.dataType)}}</text>
              </view>
            </view>
          </view>
        </view>

        <view wx:else class="empty-state">
          <text class="empty-icon">ğŸ“Š</text>
          <text class="empty-text">æš‚æ— ç›‘æµ‹æ•°æ®</text>
        </view>
      </view>
    </view>
  </view>
</view>